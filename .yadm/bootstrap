#!/bin/bash

# Because Git submodule commands cannot operate without a work tree, they must
# be run from within $HOME - the root directory of dotfiles.
cd "$HOME"

echo "Init submodules"
yadm submodule update --recursive --init

echo "Symlinking i3blocks by Anachron"
ln -sf $HOME/.yadm/submodules/anachron-i3blocks/blocks .config/i3blocks

echo "Creating symbolic links to zsh plugins"
ZSH_CUSTOM_PLUGINS=~/.oh-my-zsh/custom/plugins
mkdir -p $ZSH_CUSTOM_PLUGINS
ln -sf $HOME/.yadm/submodules/base16-shell $ZSH_CUSTOM_PLUGINS
ln -sf $HOME/.yadm/submodules/zsh-autosuggestions $ZSH_CUSTOM_PLUGINS

echo "Symlinking oh-my-zsh"
ln -sf $HOME/.yadm/submodules/oh-my-zsh .oh-my-zsh

echo "Changing default shell to ZSH"
chsh -s /bin/zsh


function download {
  echo "Downloading: $1"
  curl -fLo "$1" "$SOURCE/${1// /%20}"
}


echo "Installing fonts"
mkdir -p ~/.local/share/fonts
cd ~/.local/share/fonts

SOURCE=https://github.com/google/fonts/raw/master/apache/robotomono
download RobotoMono-Regular.ttf
download RobotoMono-Italic.ttf
download RobotoMono-Bold.ttf
download RobotoMono-BoldItalic.ttf

# patched font for use with urxvt
# non-patched font is used with i3wm because fontawesome seems to work
# better as a standalone font (there are no weird spacing issues with
# any glyphs)
SOURCE=https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/RobotoMono/complete
download "Roboto Mono Nerd Font Complete.ttf"
download "Roboto Mono Italic Nerd Font Complete.ttf"
download "Roboto Mono Bold Nerd Font Complete.ttf"
download "Roboto Mono Bold Italic Nerd Font Complete.ttf"

echo "Refreshing font cache"
fc-cache -fv

cd "$HOME"

echo "Symlinking Xresource color themes"
ln -sf $HOME/.yadm/submodules/base16-xresources/xresources .base16-xresources

echo "Loading Xresources"
xrdb .Xresources

